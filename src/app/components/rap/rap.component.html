<div class="p-4">
  <h1 class="text-2xl font-bold mb-4">DANH S√ÅCH R·∫†P</h1>

  <!-- B·∫£ng hi·ªÉn th·ªã danh s√°ch r·∫°p -->
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 text-sm">
      <thead>
        <tr class="bg-gray-100">
          <th class="px-4 py-2 border-b border-gray-200 text-left">T√™n r·∫°p</th>
          <th class="px-4 py-2 border-b border-gray-200 text-left">ƒê·ªãa ch·ªâ</th>
          <th class="px-4 py-2 border-b border-gray-200 text-left">S·ªë ph√≤ng</th>
          <th class="px-4 py-2 border-b border-gray-200 text-left w-32">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let rap of rapList; let i = index" class="hover:bg-gray-50 transition-colors">
          <td class="px-4 py-2 border-b border-gray-200">{{ rap.cinemaName }}</td>
          <td class="px-4 py-2 border-b border-gray-200">{{ rap.location }}</td>
          <td class="px-4 py-2 border-b border-gray-200">{{ rap.totalRoom }}</td>
          <td class="px-4 py-2 border-b border-gray-200">
            <!-- N√∫t Ch·ªânh s·ª≠a -->
            <button (click)="openEditModal(rap, i)"
              class="inline-flex items-center justify-center w-8 h-8 mr-2 bg-blue-500 hover:bg-blue-600 text-white rounded"
              title="Ch·ªânh s·ª≠a">
              <i class="fas fa-pencil-alt text-sm"></i>
            </button>
            <!-- N√∫t X√≥a -->
            <button (click)="deleteRap(rap)"
              class="inline-flex items-center justify-center w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded"
              title="X√≥a">
              <i class="fas fa-trash text-sm"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- N√∫t Th√™m r·∫°p (floating button) -->
  <button (click)="openAddModal()"
    class="fixed bottom-8 right-8 bg-red-500 hover:bg-red-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-2xl"
    title="Th√™m r·∫°p">
    <i class="fas fa-plus"></i>
  </button>
</div>

<!-- ========== DIALOG TH√äM R·∫†P M·ªöI ========== -->
<div *ngIf="isAddModalOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-50">
  <div class="bg-white rounded p-6 w-full max-w-md">
    <h2 class="text-xl font-bold mb-4">Th√™m r·∫°p m·ªõi</h2>

    <form #addRapForm="ngForm" (ngSubmit)="saveNewRap()">
      <!-- T√™n r·∫°p -->
      <div class="mb-4">
        <label class="block font-medium mb-1">T√™n r·∫°p <span class="text-red-500">*</span></label>
        <input type="text" name="cinemaName" [(ngModel)]="newRap.cinemaName" required #cinemaName="ngModel"
          class="border rounded w-full px-3 py-2" placeholder="Nh·∫≠p t√™n r·∫°p" />
        <div *ngIf="cinemaName.invalid && cinemaName.touched" class="text-red-500 text-sm">
          Vui l√≤ng nh·∫≠p t√™n r·∫°p
        </div>
      </div>
      <!-- ƒê·ªãa ch·ªâ -->
      <div class="mb-4">
        <label class="block font-medium mb-1">ƒê·ªãa ch·ªâ <span class="text-red-500">*</span></label>
        <input type="text" name="location" [(ngModel)]="newRap.location" required #location="ngModel"
          class="border rounded w-full px-3 py-2" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" />
        <div *ngIf="location.invalid && location.touched" class="text-red-500 text-sm">
          Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ
        </div>
      </div>
      <!-- S·ªë ph√≤ng -->
      <div class="mb-4">
        <label class="block font-medium mb-1">S·ªë ph√≤ng <span class="text-red-500">*</span></label>
        <input type="number" name="totalRoom" [(ngModel)]="newRap.totalRoom" required #totalRoom="ngModel"
          class="border rounded w-full px-3 py-2" placeholder="Nh·∫≠p s·ªë ph√≤ng" />
        <div *ngIf="totalRoom.invalid && totalRoom.touched" class="text-red-500 text-sm">
          Vui l√≤ng nh·∫≠p s·ªë ph√≤ng
        </div>
      </div>

      <div class="flex justify-end space-x-2">
        <button type="button" (click)="closeAddModal()"
          class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 text-gray-700">
          ƒê√≥ng
        </button>
        <button type="submit" class="px-4 py-2 rounded bg-blue-500 hover:bg-blue-600 text-white"
          [disabled]="addRapForm.invalid">
          L∆∞u
        </button>
      </div>
    </form>
  </div>
</div>

<div *ngIf="isEditModalOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-60">
  <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-lg transform transition-all">
    <h2 class="text-2xl font-semibold mb-4 text-gray-800">Ch·ªânh s·ª≠a r·∫°p</h2>

    <form #editRapForm="ngForm" (ngSubmit)="saveEditRap()" class="space-y-4">
      <!-- T√™n r·∫°p -->
      <div>
        <label class="block text-gray-700 font-medium">T√™n r·∫°p <span class="text-red-500">*</span></label>
        <input type="text" name="cinemaName" [(ngModel)]="editRapData.cinemaName" required #editCinemaName="ngModel"
          class="border rounded-lg w-full px-3 py-2 focus:ring focus:ring-blue-300" placeholder="Nh·∫≠p t√™n r·∫°p" />
        <div *ngIf="editCinemaName.invalid && editCinemaName.touched" class="text-red-500 text-sm">Vui l√≤ng nh·∫≠p t√™n r·∫°p
        </div>
      </div>

      <!-- ƒê·ªãa ch·ªâ -->
      <div>
        <label class="block text-gray-700 font-medium">ƒê·ªãa ch·ªâ <span class="text-red-500">*</span></label>
        <input type="text" name="location" [(ngModel)]="editRapData.location" required #editLocation="ngModel"
          class="border rounded-lg w-full px-3 py-2 focus:ring focus:ring-blue-300" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" />
        <div *ngIf="editLocation.invalid && editLocation.touched" class="text-red-500 text-sm">Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ
        </div>
      </div>

      <!-- S·ªë ph√≤ng -->
      <div>
        <label class="block text-gray-700 font-medium">S·ªë ph√≤ng <span class="text-red-500">*</span></label>
        <input type="number" name="totalRoom" [(ngModel)]="editRapData.totalRoom" required #editTotalRoom="ngModel"
          class="border rounded-lg w-full px-3 py-2 focus:ring focus:ring-blue-300" placeholder="Nh·∫≠p s·ªë ph√≤ng" />
        <div *ngIf="editTotalRoom.invalid && editTotalRoom.touched" class="text-red-500 text-sm">Vui l√≤ng nh·∫≠p s·ªë ph√≤ng
        </div>
      </div>
      <button (click)="openAddRoomModal()" type="button"
        class="flex items-center bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded">
        <span class="material-icons mr-1">add_circle_outline</span> Th√™m ph√≤ng
      </button>
      <!-- B·∫£ng danh s√°ch ph√≤ng -->
      <div class="mt-4 max-h-[300px] overflow-auto">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Danh s√°ch ph√≤ng</h3>
        <table class="w-full border border-gray-200 rounded-lg text-sm shadow-sm">
          <thead>
            <tr class="bg-gray-100 text-gray-700">
              <th class="px-4 py-2 text-left">T√™n ph√≤ng</th>
              <th class="px-4 py-2 text-left">Lo·∫°i</th>
              <th class="px-4 py-2 text-left">S·ªë gh·∫ø</th>
              <th class="px-4 py-2 text-left">Tr·∫°ng th√°i</th>
              <th class="px-4 py-2 text-center">H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let room of roomLisst; let i = index" class="hover:bg-gray-50 transition-all">
              <td class="px-4 py-2">{{ room.room_name }}</td>
              <td class="px-4 py-2">{{ room.room_style }}</td>
              <td class="px-4 py-2">{{ room.total_seat }}</td>
              <td class="px-4 py-2">
                <span
                  [ngClass]="{'text-green-600': room.status === 'active', 'text-red-600': room.status === 'inactive'}">
                  {{ room.status === 'active' ? 'Ho·∫°t ƒë·ªông' : 'Kh√¥ng ho·∫°t ƒë·ªông' }}
                </span>
              </td>
              <td class="px-4 py-2 flex space-x-2 justify-center">
                <button (click)="editRoom(i)" class="p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg shadow-sm">
                  ‚úèÔ∏è
                </button>
                <button (click)="deleteRoom(i)" class="p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg shadow-sm">
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end space-x-2 mt-4">
        <button type="button" (click)="closeEditModal()"
          class="px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded-lg shadow-sm">
          ƒê√≥ng
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg shadow-sm"
          [disabled]="editRapForm.invalid">
          L∆∞u
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Dialog th√™m ph√≤ng -->
<div *ngIf="isAddRoomModalOpen" class="modal-overlay">
  <div class="modal">
    <h2>Th√™m Ph√≤ng M·ªõi</h2>

    <!-- Form nh·∫≠p th√¥ng tin ph√≤ng -->
    <form (ngSubmit)="saveNewRoom()">
      <!-- Ch·ªçn r·∫°p 
      <label for="cinema">Ch·ªçn R·∫°p:</label>
      <select id="cinema" [(ngModel)]="cinema_id" name="cinema_id" required>
        <option *ngFor="let rap of rapList" [value]="rap.id">{{ rap.cinemaName }}</option>
      </select>
-->
      <!-- T√™n ph√≤ng -->
      <label for="room_name">T√™n Ph√≤ng:</label>
      <input type="text" id="room_name" [(ngModel)]="room_name" name="room_name" required
        placeholder="Nh·∫≠p t√™n ph√≤ng" />

      <!-- Lo·∫°i ph√≤ng -->
      <label for="room_style">Lo·∫°i Ph√≤ng:</label>
      <select id="room_style" [(ngModel)]="room_style" name="room_style" required>
        <option value="2D">2D</option>
        <option value="3D">3D</option>
        <option value="IMAX">IMAX</option>
      </select>

      <!-- T·ªïng s·ªë gh·∫ø -->
      <label for="total_seat">T·ªïng S·ªë Gh·∫ø:</label>
      <input type="number" id="total_seat" [(ngModel)]="total_seat" name="total_seat" required min="1"
        placeholder="Nh·∫≠p t·ªïng s·ªë gh·∫ø" />

      <!-- N√∫t L∆∞u v√† ƒê√≥ng -->
      <div class="modal-buttons">
        <button type="submit" class="btn btn-primary">L∆∞u</button>
        <button type="button" class="btn btn-secondary" (click)="closeAddRoomModal()">H·ªßy</button>
      </div>
    </form>
  </div>
</div>