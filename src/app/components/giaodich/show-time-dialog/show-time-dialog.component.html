<!-- cinema-dialog.component.html -->
<div class="dialog-overlay">
    <div class="dialog-container">
        <div class="dialog-header">
            <div class="header-content">
                <div class="header-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="header-text">
                    <h2 class="dialog-title">LỊCH CHIẾU THEO NGÀY</h2>
                    <p class="dialog-subtitle">Xem lịch chiếu phim tại rạp của bạn</p>
                </div>
            </div>
            <div class="header-actions">
                <!-- Refresh button -->
                <button 
                    class="refresh-button" 
                    (click)="refreshCinemas()" 
                    [disabled]="isLoading"
                    title="Làm mới dữ liệu">
                    <i class="fas fa-sync-alt" [ngClass]="{'fa-spin': isLoading}"></i>
                </button>
                <!-- Close button -->
                <button class="close-button" (click)="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <div class="dialog-content">
            <!-- Hiển thị thông tin rạp của user -->
            <div *ngIf="currentUser?.cinema_name" class="user-cinema-info">
                <div class="cinema-info-content">
                    <div class="cinema-info-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="cinema-info-text">
                        <span class="cinema-label">Rạp của bạn:</span>
                        <span class="cinema-name">{{ currentUser.cinema_name }}</span>
                    </div>
                </div>
            </div>

            <!-- Loading spinner cải thiện -->
            <div *ngIf="isLoading" class="loading-container">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <div class="spinner-icon">
                        <i class="fas fa-film"></i>
                    </div>
                </div>
                <p class="loading-text">Đang tải lịch chiếu...</p>
                <div class="loading-progress">
                    <div class="progress-bar"></div>
                </div>
            </div>

            <!-- Error message với retry button -->
            <div *ngIf="error && !isLoading" class="error-container">
                <div class="error-content">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="error-text">
                        <h4 class="error-title">Đã xảy ra lỗi</h4>
                        <p class="error-message">{{ error }}</p>
                    </div>
                </div>
                <button class="retry-button" (click)="retryLoading()">
                    <i class="fas fa-sync-alt mr-2"></i>
                    Thử lại
                </button>
            </div>

            <!-- Card grid for cinemas -->
            <div class="cinema-grid" *ngIf="!isLoading && !error && cinemas.length > 0">
                <div *ngFor="let rap of cinemas; let i = index" class="cinema-card">
                    <div class="card-content">
                        <div class="card-header">
                            <div class="cinema-header-icon">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="cinema-header-text">
                                <h3 class="cinema-name">{{ rap.cinemaName }}</h3>
                                <p class="cinema-location">
                                    <i class="fas fa-map-marker-alt"></i>
                                    {{ rap.location }}
                                </p>
                            </div>
                        </div>

                        <!-- Showtimes -->
                        <div class="showtimes-section" *ngIf="rap.showtimes && rap.showtimes.length > 0">
                            <div class="showtimes-header">
                                <i class="fas fa-clock"></i>
                                <span class="showtimes-title">Suất chiếu hôm nay</span>
                            </div>
                            <div class="showtime-grid">
                                <button 
                                    *ngFor="let st of rap.showtimes" 
                                    (click)="showRomDialog(st.roomId, st.id)" 
                                    class="showtime-button">
                                    <div class="showtime-time">
                                        <span class="start-time">{{ st.startTime }}</span>
                                        <span class="time-separator">-</span>
                                        <span class="end-time">{{ st.endTime }}</span>
                                    </div>
                                    <div class="showtime-room">
                                        <i class="fas fa-couch"></i>
                                        <span>Phòng {{ st.roomId }}</span>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- No showtime -->
                        <div *ngIf="!rap.showtimes || rap.showtimes.length === 0" class="no-showtime">
                            <div class="no-showtime-content">
                                <i class="fas fa-calendar-times"></i>
                                <span>Không có suất chiếu hôm nay</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty state -->
            <div *ngIf="!isLoading && !error && cinemas.length === 0" class="empty-state">
                <div class="empty-icon">
                    <i class="fas fa-theater-masks"></i>
                </div>
                <div class="empty-content">
                    <h3 class="empty-title">Phim hiện không chiếu</h3>
                    <p class="empty-text">Phim này hiện tại không được chiếu tại rạp của bạn</p>
                    <div class="empty-cinema-info">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ currentUser?.cinema_name || 'Không xác định' }}</span>
                    </div>
                    <button class="refresh-empty-button" (click)="refreshCinemas()">
                        <i class="fas fa-sync-alt mr-2"></i>
                        Kiểm tra lại
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>