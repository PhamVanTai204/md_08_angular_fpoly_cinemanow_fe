<div class="p-4 bg-white min-h-screen">
  <!-- Tiêu đề + Tìm kiếm -->
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-xl font-bold">Danh sách lịch chiếu</h1>
    <div class="relative">
      <input
        [(ngModel)]="searchTerm"
        type="text"
        placeholder="Nhập mã phim"
        class="border border-gray-300 rounded-md py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-400"
      />
      <button
        (click)="onSearch()"
        class="absolute right-1 top-1 bottom-1 text-sm px-2 bg-blue-500 text-white rounded-md hover:bg-blue-600"
      >
        Tìm
      </button>
    </div>
  </div>

  <!-- Bảng showtimes -->
  <div class="overflow-x-auto">
    <table class="min-w-full border-collapse border border-gray-200 text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="border border-gray-200 px-4 py-2 text-left">Mã Lịch Chiếu</th>
          <th class="border border-gray-200 px-4 py-2 text-left">Mã Phim</th>
          <th class="border border-gray-200 px-4 py-2 text-left">Mã Phòng</th>
          <th class="border border-gray-200 px-4 py-2 text-left">Ngày Chiếu</th>
          <th class="border border-gray-200 px-4 py-2 text-left">Giờ Bắt Đầu</th>
          <th class="border border-gray-200 px-4 py-2 text-left">Giờ Kết Thúc</th>
          <th class="border border-gray-200 px-4 py-2 text-center">Hành Động</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let lich of dsLichChieu">
          <td class="border border-gray-200 px-4 py-2">{{ lich.showtime_id }}</td>
          <td class="border border-gray-200 px-4 py-2">{{ lich.movie_id }}</td>
          <td class="border border-gray-200 px-4 py-2">{{ lich.room_id }}</td>
          <td class="border border-gray-200 px-4 py-2">
            {{ lich.show_date | date: 'yyyy-MM-dd' }}
          </td>
          <td class="border border-gray-200 px-4 py-2">
            {{ lich.start_time | date: 'HH:mm' }}
          </td>
          <td class="border border-gray-200 px-4 py-2">
            {{ lich.end_time | date: 'HH:mm' }}
          </td>
          <td class="border border-gray-200 px-4 py-2 text-center">
            <!-- Nút Sửa -->
            <button
              class="mr-2 text-blue-600 hover:text-blue-800"
              (click)="editSchedule(lich)"
              title="Chỉnh sửa"
            >
              <svg
                class="w-5 h-5 inline-block"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15.232 5.232l3.536 3.536m-2.036-7.036
                     a2.828 2.828 0 014 4l-10 10a4 4 0 01-1.414.586l-3
                     .5a.5.5 0 01-.586-.586l.5-3a4 4 0
                     01.586-1.414l10-10z"
                ></path>
              </svg>
            </button>
            <!-- Nút Xoá -->
            <button
              class="text-red-600 hover:text-red-800"
              (click)="deleteSchedule(lich)"
              title="Xoá"
            >
              <svg
                class="w-5 h-5 inline-block"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M19 7l-.867 12.142A2 2 0 0116.138
                     21H7.862a2 2 0 01-1.995-1.858L5
                     7m5-4h4m-6 4h8"
                ></path>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Nút Thêm (float button) -->
  <button
    (click)="openAddModal()"
    class="fixed bottom-8 right-8 bg-pink-500 hover:bg-pink-600 text-white rounded-full p-4 shadow-lg focus:outline-none"
    title="Thêm lịch chiếu"
  >
    <svg
      class="w-6 h-6"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path>
    </svg>
  </button>
</div>

<!-- Modal Thêm/Sửa -->
<div
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"
  *ngIf="isMainModalOpen"
>
  <div class="bg-white w-[400px] rounded shadow-lg relative">
    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-2 border-b">
      <h2 class="font-bold text-lg">
        {{ isEditing ? 'Sửa lịch chiếu' : 'Thêm lịch chiếu' }}
      </h2>
      <button
        class="text-red-500 hover:text-red-600"
        (click)="closeMainModal()"
        title="Đóng"
      >
        <svg
          class="w-5 h-5"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10
               8.586l4.293-4.293a1 1 0
               011.414 1.414L11.414 10l4.293
               4.293a1 1 0
               01-1.414 1.414L10 11.414l-4.293
               4.293a1 1 0
               01-1.414-1.414L8.586 10 4.293
               5.707a1 1 0 010-1.414z"
            clip-rule="evenodd"
          ></path>
        </svg>
      </button>
    </div>

    <!-- Body: Form -->
    <div class="p-4 space-y-4">
      <!-- showtime_id (auto-generated, disabled for new entries) -->
      <div *ngIf="isEditing">
        <label class="block mb-1 font-medium">Mã lịch chiếu</label>
        <input
          [(ngModel)]="lichChieuForm.showtime_id"
          type="text"
          disabled
          class="w-full bg-gray-100 border border-gray-300 rounded px-3 py-2"
        />
      </div>
      
      <!-- movie_id -->
      <div>
        <label class="block mb-1 font-medium">Mã phim</label>
        <input
          [(ngModel)]="lichChieuForm.movie_id"
          type="text"
          class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-400"
        />
      </div>
      
      <!-- room_id -->
      <div>
        <label class="block mb-1 font-medium">Mã phòng</label>
        <input
          [(ngModel)]="lichChieuForm.room_id"
          type="text"
          class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-400"
        />
      </div>
      
      <!-- show_date -->
      <div>
        <label class="block mb-1 font-medium">Ngày chiếu</label>
        <input
          [(ngModel)]="lichChieuForm.show_date"
          type="date"
          class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-400"
        />
      </div>
      
      <!-- start_time -->
      <div>
        <label class="block mb-1 font-medium">Giờ bắt đầu</label>
        <input
          [(ngModel)]="lichChieuForm.start_time"
          type="time"
          class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-400"
        />
      </div>
      
      <!-- end_time -->
      <div>
        <label class="block mb-1 font-medium">Giờ kết thúc</label>
        <input
          [(ngModel)]="lichChieuForm.end_time"
          type="time"
          class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-400"
        />
      </div>
    </div>

    <!-- Footer -->
    <div class="flex justify-end px-4 py-3 border-t">
      <button
        (click)="closeMainModal()"
        class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded mr-2"
      >
        HỦY
      </button>
      <button
        (click)="saveSchedule()"
        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded"
      >
        LƯU
      </button>
    </div>
  </div>
</div>

<!-- Modal Xoá -->
<div
  class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"
  *ngIf="isDeleteModalOpen"
>
  <div class="bg-white w-[400px] rounded shadow-lg relative">
    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-2 border-b">
      <h2 class="font-bold text-lg">Xoá lịch chiếu</h2>
      <button
        class="text-red-500 hover:text-red-600"
        (click)="closeDeleteModal()"
        title="Đóng"
      >
        <svg
          class="w-5 h-5"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10
               8.586l4.293-4.293a1 1 0
               011.414 1.414L11.414 10l4.293
               4.293a1 1 0
               01-1.414 1.414L10 11.414l-4.293
               4.293a1 1 0
               01-1.414-1.414L8.586 10 4.293
               5.707a1 1 0 010-1.414z"
            clip-rule="evenodd"
          ></path>
        </svg>
      </button>
    </div>

    <!-- Body -->
    <div class="p-4 space-y-4">
      <p>
        Bạn có chắc muốn xóa lịch chiếu có mã
        <strong>"{{ lichChieuDangXoa?.showtime_id }}"</strong>?
      </p>
      <p class="text-sm text-gray-600">
        Nhập mật khẩu <strong>hiendz</strong> để xác nhận:
      </p>
      <input
        [(ngModel)]="deletePassword"
        type="password"
        placeholder="Nhập mật khẩu"
        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-400"
      />
    </div>

    <!-- Footer -->
    <div class="flex justify-end px-4 py-3 border-t">
      <button
        (click)="closeDeleteModal()"
        class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded mr-2"
      >
        HỦY
      </button>
      <button
        (click)="confirmDelete()"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded"
      >
        XÓA
      </button>
    </div>
  </div>
</div>